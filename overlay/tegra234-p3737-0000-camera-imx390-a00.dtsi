// SPDX-License-Identifier: GPL-2.0-only
// Copyright (c) 2018-2023, NVIDIA CORPORATION & AFFILIATES. All rights reserved.

#include "tegra234-camera-imx390-a00.dtsi"
#include <dt-bindings/clock/tegra234-clock.h>

#define CAM0_RST_L	TEGRA234_MAIN_GPIO(H, 3)
#define CAMERA_I2C_MUX_BUS(x) (0x1E + x)

/* camera control gpio definitions */
/ {
	fragment-camera-imx390@0 {
		target-path = "/";
		__overlay__ {
			bus@0{
				i2c@3180000 {
					tca9546@70 {
						compatible = "nxp,pca9546";
						reg = <0x70>;
						#address-cells = <1>;
						#size-cells = <0>;
						skip_mux_detect = "yes";
						force_bus_start = <CAMERA_I2C_MUX_BUS(0)>;
						i2c@0 {
							reg = <0>;
							i2c-mux,deselect-on-exit;
							#address-cells = <1>;
							#size-cells = <0>;
							dser: max9296@48 {
								compatible = "maxim,max9296";
								reg = <0x48>;
								csi-mode = "2x4";
								max-src = <2>;
								reset-gpios = <&gpio CAM0_RST_L GPIO_ACTIVE_HIGH>;
							};
							ser_prim: max9295_prim@62 {
								compatible = "maxim,max9295";
								reg = <0x62>;
								is-prim-ser;
							};
							ser_a: max9295_a@40 {
								compatible = "maxim,max9295";
								reg = <0x40>;
								nvidia,gmsl-dser-device = <&dser>;
							};
							ser_b: max9295_b@60 {
								compatible = "maxim,max9295";
								reg = <0x60>;
								nvidia,gmsl-dser-device = <&dser>;
							};
							imx390_a@1b {
								def-addr = <0x1a>;
								/* Define any required hw resources needed by driver */
								/* ie. clocks, io pins, power sources */
								clocks = <&bpmp TEGRA234_CLK_EXTPERIPH1>,
										<&bpmp TEGRA234_CLK_EXTPERIPH1>;
								clock-names = "extperiph1", "pllp_grtba";
								mclk = "extperiph1";
								nvidia,gmsl-ser-device = <&ser_a>;
								nvidia,gmsl-dser-device = <&dser>;
							};
							imx390_b@1c {
								def-addr = <0x1a>;
								/* Define any required hw resources needed by driver */
								/* ie. clocks, io pins, power sources */
								clocks = <&bpmp TEGRA234_CLK_EXTPERIPH1>,
										<&bpmp TEGRA234_CLK_EXTPERIPH1>;
								clock-names = "extperiph1", "pllp_grtba";
								mclk = "extperiph1";
								nvidia,gmsl-ser-device = <&ser_b>;
								nvidia,gmsl-dser-device = <&dser>;
							};
						};
					};
				};
			};
		};
	};
};
