// SPDX-License-Identifier: GPL-2.0
// Copyright (c) 2022-2023, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.


/dts-v1/;
/plugin/;

#include "overlay/tegra234-overlay.dtsi"
#include "overlay/tegra234-thermal.dtsi"
#include "overlay/tegra234-thermal-shutdown.dtsi"
#include "tegra234-status-overlay.dtsi"
#include "tegra234-p3737-0000.dtsi"
#include "tegra234-p3701-0000.dtsi"
#include "overlay/tegra234-audio-dai-links-overlay.dtsi"
#include "tegra234-dcb-p3737-0000-p3701-0000.dtsi"
#include "overlay/tegra234-camera.dtsi"

/ {
	compatible = "nvidia,p3737-0000+p3701-0000";

	fragment-t234-p3737-p3701@0 {
		target-path = "/";
		__overlay__ {
			bus@0 {
				smmu_test {
					compatible = "nvidia,smmu_test";
					iommus = <&smmu_niso0 TEGRA234_SID_SMMU_TEST>;
					status = "okay";
				};
			};
		};
	};

	fragment-t234-p3737-p3701@5 {
		target-path = "/bus@0/i2c@31b0000";
		__overlay__ {
			nvidia,hw-instance-id = <0x5>;
		};
	};

	fragment-t234-p3737-p3701@8 {
		target-path = "/bus@0/i2c@31e0000";
		__overlay__ {
			status = "okay";

			#address-cells = <1>;
			#size-cells = <0>;

			rt5640: rt5640.8-001c@1c {
				compatible = "realtek,rt5640";
				reg = <0x1c>;

				clocks = <&bpmp TEGRA234_CLK_AUD_MCLK>;
				clock-names = "mclk";

				realtek,dmic1-data-pin = <0>; /* RT5659_DMIC1_NULL */
				realtek,dmic2-data-pin = <0>; /* RT5659_DMIC2_NULL */
				realtek,jack-detect-source = <7>;

				/* Codec IRQ output */
				interrupt-parent = <&gpio>;
				interrupts = <TEGRA234_MAIN_GPIO(AC, 5) GPIO_ACTIVE_HIGH>;

				#sound-dai-cells = <1>;
				sound-name-prefix = "CVB-RT";

				status = "okay";
			};
		};
	};

	fragment-t234-p3737-p3701@9 {
		target-path = "/";
		__overlay__ {
			tegra_sound_graph: tegra_sound: sound {
				compatible = "nvidia,tegra186-ape";
				clocks = <&bpmp TEGRA234_CLK_PLLA>,
					 <&bpmp TEGRA234_CLK_PLLA_OUT0>,
					 <&bpmp TEGRA234_CLK_AUD_MCLK>;
				clock-names = "pll_a", "pll_a_out0", "extern1";
				assigned-clocks = <&bpmp TEGRA234_CLK_AUD_MCLK>;
				assigned-clock-parents = <&bpmp TEGRA234_CLK_PLLA_OUT0>;

				nvidia-audio-card,name = "NVIDIA Jetson AGX Orin APE";

				nvidia-audio-card,widgets =
					"Headphone",	"CVB-RT Headphone Jack",
					"Microphone",	"CVB-RT Mic Jack",
					"Speaker",	"CVB-RT Int Spk",
					"Microphone",	"CVB-RT Int Mic";

				nvidia-audio-card,routing =
					"CVB-RT Headphone Jack",     "CVB-RT HPOL",
					"CVB-RT Headphone Jack",     "CVB-RT HPOR",
					"CVB-RT IN1P",		     "CVB-RT Mic Jack",
					"CVB-RT IN2P",		     "CVB-RT Mic Jack",
					"CVB-RT Int Spk",	     "CVB-RT SPOLP",
					"CVB-RT Int Spk",	     "CVB-RT SPORP",
					"CVB-RT DMIC1",		     "CVB-RT Int Mic",
					"CVB-RT DMIC2",		     "CVB-RT Int Mic";

				nvidia-audio-card,mclk-fs = <256>;

				nvidia-audio-card,dai-link@76 {
					link-name = "rt5640-playback";
					codec {
						sound-dai = <&rt5640 0>;
						prefix = "CVB-RT";
					};
				};

				hdr40_snd_link_i2s: nvidia-audio-card,dai-link@77 { };
			};

			reserved-memory {
				#address-cells = <2>;
				#size-cells = <2>;
				ranges;

				linux,cma { /* Needed for nvgpu comptags */
					compatible = "shared-dma-pool";
					reusable;
					size = <0x0 0x10000000>; /* 256MB */
					alignment = <0x0 0x10000>;
					linux,cma-default;
					status = "okay";
				};
			};
		};
	};

	fragment-t234-p3737-p3701@10 {
		target-path = "/";
		__overlay__ {
			cpus {
				cpu_core_power_states {
					C1: c1 {
						compatible = "arm,idle-state";
						state-name = "Clock gated";
						wakeup-latency-us = <1>;
						min-residency-us = <1>;
						status = "okay";
					};

					C7: c7 {
						compatible = "arm,idle-state";
						state-name = "Core powergate";
						wakeup-latency-us = <5000>;
						arm,psci-suspend-param= <0x40000007>;
						min-residency-us = <30000>;
						status = "okay";
					};
				};

				cpu@0 {
					cpu-idle-states = <&C7>;
				};

				cpu@100 {
					cpu-idle-states = <&C7>;
				};

				cpu@200 {
					cpu-idle-states = <&C7>;
				};

				cpu@300 {
					cpu-idle-states = <&C7>;
				};

				cpu@10000 {
					cpu-idle-states = <&C7>;
				};

				cpu@10100 {
					cpu-idle-states = <&C7>;
				};

				cpu@10200 {
					cpu-idle-states = <&C7>;
				};

				cpu@10300 {
					cpu-idle-states = <&C7>;
				};

				cpu@20000 {
					cpu-idle-states = <&C7>;
				};

				cpu@20100 {
					cpu-idle-states = <&C7>;
				};

				cpu@20200 {
					cpu-idle-states = <&C7>;
				};

				cpu@20300 {
					cpu-idle-states = <&C7>;
				};
			};
		};
	};

	fragment-t234-p3737-p3701@23 {
		target-path = "/bus@0";
		__overlay__ {
			ethernet@6800000 {
				status = "okay";
				nvidia,mac-addr-idx = <0>;
				nvidia,max-platform-mtu = <16383>;
				/* 1=enable, 0=disable */
				nvidia,pause_frames = <1>;
				phy-handle = <&mgbe0_aqr113c_phy>;
				phy-mode = "10gbase-r";
				/* 0:XFI 10G, 1:XFI 5G, 2:USXGMII 10G, 3:USXGMII 5G */
				nvidia,phy-iface-mode = <0>;
				nvidia,phy-reset-gpio = <&gpio TEGRA234_MAIN_GPIO(Y, 1) 0>;
				nvidia,mdio_addr = <0>;

				mdio {
					compatible = "nvidia,eqos-mdio";
					#address-cells = <1>;
					#size-cells = <0>;

					mgbe0_aqr113c_phy: ethernet_phy@0 {
						compatible = "ethernet-phy-ieee802.3-c45";
						reg = <0x0>;
						nvidia,phy-rst-pdelay-msec = <150>; /* msec */
						nvidia,phy-rst-duration-usec = <221000>; /* usec */
						interrupt-parent = <&gpio>;
						interrupts = <TEGRA234_MAIN_GPIO(Y, 3) IRQ_TYPE_LEVEL_LOW>;
					};
				};
			};

 			hdr40_i2c1: i2c@c250000 { };
		};
	};

	fragment-t234-p3737-p3701@24 {
		target-path = "/";
		__overlay__ {
			hsp_rce: tegra-hsp@b950000 {
				compatible = "nvidia,tegra186-hsp";
				reg = <0 0x0b950000 0 0x00090000>;
				interrupts =	<GIC_SPI TEGRA234_IRQ_RCE_HSP_SHARED_1 IRQ_TYPE_LEVEL_HIGH>,
						<GIC_SPI TEGRA234_IRQ_RCE_HSP_SHARED_2 IRQ_TYPE_LEVEL_HIGH>,
						<GIC_SPI TEGRA234_IRQ_RCE_HSP_SHARED_3 IRQ_TYPE_LEVEL_HIGH>,
						<GIC_SPI TEGRA234_IRQ_RCE_HSP_SHARED_4 IRQ_TYPE_LEVEL_HIGH>;
				#mbox-cells = <2>;
				interrupt-names = "shared1", "shared2", "shared3", "shared4";
				status = "okay";
			};
		};
	};

	fragment-t234-p3737-p3701@25 {
		target-path = "/bus@0/aconnect@2900000/ahub@2900800/i2s@2901100/ports/port@1";
		__overlay__ {
			hdr40_snd_i2s_dap_ep: endpoint { };
		};
	};
};
