// SPDX-License-Identifier: GPL-2.0
// Copyright (c) 2022, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.

/ {
	fragment-t234-p3737-0000@0 {
		target-path = "/";
		__overlay__ {
			bus@0 {
				padctl@3520000 {
					ports {
						usb2-0 {
							mode = "otg";
							usb-role-switch;
							port {
								hs_typec_p1: endpoint {
									remote-endpoint = <&hs_ucsi_ccg_p1>;
								};
							};
						};

						usb2-1 {
							port {
								hs_typec_p0: endpoint {
									remote-endpoint = <&hs_ucsi_ccg_p0>;
								};
							};
						};

						usb3-0 {
							port {
								ss_typec_p0: endpoint {
									remote-endpoint = <&ss_ucsi_ccg_p0>;
								};
							};
						};

						usb3-1 {
							port {
								ss_typec_p1: endpoint {
									remote-endpoint = <&ss_ucsi_ccg_p1>;
								};
							};
						};
					};
				};

				usb@3550000 {
					phys = <&xpads_usb2_lanes_usb2_0>,
						<&xpads_usb3_lanes_usb3_1>;
					phy-names = "usb2-0", "usb3-1";
				};

				i2c@c240000 {
					ucsi-ccg@8 {
						compatible = "cypress,cypd4226";
						cypress,firmware-build = "nvidia,jetson-agx-xavier";
						interrupt-parent = <&gpio>;
						interrupts = <TEGRA234_MAIN_GPIO(Y, 4) IRQ_TYPE_LEVEL_LOW>;
						reg = <0x08>;
						#address-cells = <1>;
						#size-cells = <0>;
						ccg_typec_con0: connector@0 {
							compatible = "usb-c-connector";
							reg = <0>;
							label = "USB-C";
							data-role = "host";
							#address-cells = <1>;
							#size-cells = <0>;
							port@0 {
								reg = <0>;
								hs_ucsi_ccg_p0: endpoint {
									remote-endpoint = <&hs_typec_p0>;
								};
							};
							port@1 {
								reg = <1>;
								ss_ucsi_ccg_p0: endpoint {
									remote-endpoint = <&ss_typec_p0>;
								};
							};
						};
						ccg_typec_con1: connector@1 {
							compatible = "usb-c-connector";
							reg = <1>;
							label = "USB-C";
							data-role = "dual";
							#address-cells = <1>;
							#size-cells = <0>;
							port@0 {
								reg = <0>;
								hs_ucsi_ccg_p1: endpoint {
									remote-endpoint = <&hs_typec_p1>;
								};
							};
							port@1 {
								reg = <1>;
								ss_ucsi_ccg_p1: endpoint {
									remote-endpoint = <&ss_typec_p1>;
								};
							};
						};
					};
				};

				i2c@31e0000 {
					rt5640: rt5640.8-001c@1c {
						compatible = "realtek,rt5640";
						reg = <0x1c>;

						clocks = <&bpmp TEGRA234_CLK_AUD_MCLK>;
						clock-names = "mclk";

						realtek,dmic1-data-pin = <0>; /* RT5659_DMIC1_NULL */
						realtek,dmic2-data-pin = <0>; /* RT5659_DMIC2_NULL */
						realtek,jack-detect-source = <7>;

						/* Codec IRQ output */
						interrupt-parent = <&gpio>;
						interrupts = <TEGRA234_MAIN_GPIO(AC, 5) GPIO_ACTIVE_HIGH>;

						#sound-dai-cells = <1>;
						sound-name-prefix = "CVB-RT";

						status = "okay";
					};
				};

				aconnect@2900000 {
					ahub@2900800 {
						i2s@2901100 {
							ports {
								port@1 {
									hdr40_snd_i2s_dap_ep: endpoint {
									};
								};
							};
						};
					};
				};

				ethernet@6800000 {
					nvidia,mac-addr-idx = <0>;
					nvidia,max-platform-mtu = <16383>;
					/* 1=enable, 0=disable */
					nvidia,pause_frames = <1>;
					phy-handle = <&mgbe0_aqr113c_phy>;
					phy-mode = "10gbase-r";
					/* 0:XFI 10G, 1:XFI 5G, 2:USXGMII 10G, 3:USXGMII 5G */
					nvidia,phy-iface-mode = <0>;
					nvidia,phy-reset-gpio = <&gpio TEGRA234_MAIN_GPIO(Y, 1) 0>;
					nvidia,mdio_addr = <0>;

					mdio {
						compatible = "nvidia,eqos-mdio";
						#address-cells = <1>;
						#size-cells = <0>;

						mgbe0_aqr113c_phy: ethernet_phy@0 {
							compatible = "ethernet-phy-ieee802.3-c45";
							reg = <0x0>;
							nvidia,phy-rst-pdelay-msec = <150>; /* msec */
							nvidia,phy-rst-duration-usec = <221000>; /* usec */
							interrupt-parent = <&gpio>;
							interrupts = <TEGRA234_MAIN_GPIO(Y, 3) IRQ_TYPE_LEVEL_LOW>;
						};
					};
				};
			};

			tegra_sound_graph: tegra_sound: sound {
				compatible = "nvidia,tegra186-ape";
				clocks = <&bpmp TEGRA234_CLK_PLLA>,
					 <&bpmp TEGRA234_CLK_PLLA_OUT0>,
					 <&bpmp TEGRA234_CLK_AUD_MCLK>;
				clock-names = "pll_a", "pll_a_out0", "extern1";
				assigned-clocks = <&bpmp TEGRA234_CLK_AUD_MCLK>;
				assigned-clock-parents = <&bpmp TEGRA234_CLK_PLLA_OUT0>;

				nvidia-audio-card,name = "NVIDIA Jetson AGX Orin APE";

				nvidia-audio-card,widgets =
					"Headphone",	"CVB-RT Headphone Jack",
					"Microphone",	"CVB-RT Mic Jack",
					"Speaker",	"CVB-RT Int Spk",
					"Microphone",	"CVB-RT Int Mic";

				nvidia-audio-card,routing =
					"CVB-RT Headphone Jack",     "CVB-RT HPOL",
					"CVB-RT Headphone Jack",     "CVB-RT HPOR",
					"CVB-RT IN1P",		     "CVB-RT Mic Jack",
					"CVB-RT IN2P",		     "CVB-RT Mic Jack",
					"CVB-RT Int Spk",	     "CVB-RT SPOLP",
					"CVB-RT Int Spk",	     "CVB-RT SPORP",
					"CVB-RT DMIC1",		     "CVB-RT Int Mic",
					"CVB-RT DMIC2",		     "CVB-RT Int Mic";

				nvidia-audio-card,mclk-fs = <256>;

				nvidia-audio-card,dai-link@76 {
					link-name = "rt5640-playback";
					codec {
						sound-dai = <&rt5640 0>;
						prefix = "CVB-RT";
					};
				};

				hdr40_snd_link_i2s: nvidia-audio-card,dai-link@77 { };
			};

			reserved-memory {
				#address-cells = <2>;
				#size-cells = <2>;
				ranges;

				linux,cma { /* Needed for nvgpu comptags */
					compatible = "shared-dma-pool";
					reusable;
					size = <0x0 0x10000000>; /* 256MB */
					alignment = <0x0 0x10000>;
					linux,cma-default;
					status = "okay";
				};
			};
		};
	};
};
