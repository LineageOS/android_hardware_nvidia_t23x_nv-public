// SPDX-License-Identifier: GPL-2.0-only
// Copyright (c) 2022-2023, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.

/ {
	fragment-t234-p3737-0000@0 {
		target-path = "/";
		__overlay__ {
			bus@0 {
				padctl@3520000 {
					ports {
						usb2-0 {
							mode = "otg";
							usb-role-switch;
						};
					};
				};

				aconnect@2900000 {
					ahub@2900800 {
						i2s@2901100 {
							ports {
								port@1 {
									hdr40_snd_i2s_dap_ep: endpoint {
									};
								};
							};
						};
					};
				};

				ethernet@6800000 {
					nvidia,mac-addr-idx = <0>;
					nvidia,max-platform-mtu = <16383>;
					/* 1=enable, 0=disable */
					nvidia,pause_frames = <1>;
					phy-handle = <&mgbe0_aqr113c_phy>;
					phy-mode = "10gbase-r";
					/* 0:XFI 10G, 1:XFI 5G, 2:USXGMII 10G, 3:USXGMII 5G */
					nvidia,phy-iface-mode = <0>;
					nvidia,phy-reset-gpio = <&gpio TEGRA234_MAIN_GPIO(Y, 1) 0>;
					nvidia,mdio_addr = <0>;

					mdio {
						compatible = "nvidia,eqos-mdio";
						#address-cells = <1>;
						#size-cells = <0>;

						mgbe0_aqr113c_phy: phy@0 {
							compatible = "ethernet-phy-ieee802.3-c45";
							reg = <0x0>;
							nvidia,phy-rst-pdelay-msec = <150>; /* msec */
							nvidia,phy-rst-duration-usec = <221000>; /* usec */
							interrupt-parent = <&gpio>;
							interrupts = <TEGRA234_MAIN_GPIO(Y, 3) IRQ_TYPE_LEVEL_LOW>;
						};
					};
				};
			};

			tegra_sound_graph: tegra_sound: sound {
				compatible = "nvidia,tegra186-audio-graph-card",
					     "nvidia,tegra186-ape";
				clocks = <&bpmp TEGRA234_CLK_PLLA>,
					 <&bpmp TEGRA234_CLK_PLLA_OUT0>,
					 <&bpmp TEGRA234_CLK_AUD_MCLK>;
				clock-names = "pll_a", "plla_out0", "extern1";
				assigned-clocks = <&bpmp TEGRA234_CLK_AUD_MCLK>;
				assigned-clock-parents = <&bpmp TEGRA234_CLK_PLLA_OUT0>;

				nvidia-audio-card,name = "NVIDIA Jetson AGX Orin APE";

				nvidia-audio-card,mclk-fs = <256>;

				hdr40_snd_link_i2s: nvidia-audio-card,dai-link@77 { };
			};

			eeprom-manager {
				data-size = <0x100>;
				bus@0 {
					i2c-bus = <&gen1_i2c>;
					eeprom@1 {
						slave-address = <0x56>;
						label = "cvb";
					};
				};
			};
		};
	};

	fragment-t234-p3737-0000@1 {
		target-path = "/";
		board_config {
			ids = ">=3737-0000-TS4", ">=3737-0000-RC1", ">=3737-0000-300";
		};
		__overlay__ {
			bus@0 {
				i2c@31e0000 {
					rt5640: audio-codec@1c {
						#sound-dai-cells = <1>;
						status = "okay";
					};
				};
			};

			sound {
				nvidia-audio-card,widgets =
					"Headphone",	"CVB-RT Headphone Jack",
					"Microphone",	"CVB-RT Mic Jack",
					"Speaker",	"CVB-RT Int Spk",
					"Microphone",	"CVB-RT Int Mic";

				nvidia-audio-card,routing =
					"CVB-RT Headphone Jack",     "CVB-RT HPOL",
					"CVB-RT Headphone Jack",     "CVB-RT HPOR",
					"CVB-RT IN1P",		     "CVB-RT Mic Jack",
					"CVB-RT IN2P",		     "CVB-RT Mic Jack",
					"CVB-RT Int Spk",	     "CVB-RT SPOLP",
					"CVB-RT Int Spk",	     "CVB-RT SPORP",
					"CVB-RT DMIC1",		     "CVB-RT Int Mic",
					"CVB-RT DMIC2",		     "CVB-RT Int Mic";

				nvidia-audio-card,dai-link@76 {
					link-name = "rt5640-playback";
					codec {
						sound-dai = <&rt5640 0>;
						prefix = "CVB-RT";
					};
				};
			};
		};
	};

	fragment-t234-p3737-0000@3 {
		target-path = "/";
		board_config {
			ids = "3737-0000-TS1","3737-0000-TS2","3737-0000-TS3","3737-0000-EB1","3737-0000-EB2","3737-0000-EB3","3737-0000-000","3737-0000-100","3737-0000-200";
		};
		__overlay__ {
			bus@0{
				i2c@c240000 {
					typec@8 {
						interrupt-parent = <&gpio_aon>;
						interrupts = <TEGRA234_AON_GPIO(BB, 2) IRQ_TYPE_LEVEL_LOW>;
					};
				};
			};
		};
	};
};
